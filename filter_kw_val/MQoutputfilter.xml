<tool id="MQoutputfilter" name="Filter out keywords and/or numerical values" version="0.1.0">
    <description>Filter a file by keyworks or values</description>
    <requirements>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
        ##echo $options.np.number_of_proteins > $output1
        python /projet/galaxydev/galaxy/tools/proteore_uc1/filter_kw_val/filter_kw_val.py 
        -i "$input1" 
        -o "$output1"
        --trash_file "$trash_file"

        ## Keywords
        #for $i, $key in enumerate($keyword)
            #if $key.k.kw != "None"
                #if $key.k.kw == "text"
                    --kw "$key.k.txt" "$key.k.ncol" "$key.match"
                #else if $key.k.kw == "file"
                    --kw_file "$key.k.file" "$key.k.ncol" "$key.match"
                #end if
            #end if
        #end for
        
        ## Number of proteins
        #for $i, $val in enumerate($value)
            #if $val.v.val != "None"
                --value
                #if $val.v.val == "Equal"
                    $val.v.equal "$value.ncol" "="
                #else if $val.v.val == "Higher"
                    $val.v.higher "$val.v.ncol" ">"
                #else if $val.v.val == "Equal or higher"
                    $val.v.equal_higher "$val.v.ncol" ">="
                #else if $val.v.val == "Lower"
                    $val.v.lower "$val.v.ncol" "<"
                #else
                    $val.v.equal_lower "$val.v.ncol" "<="
                #end if
            #end if
        #end for
       
    ]]></command>
    <inputs>
        <param type="data" name="input1" format="txt,tabular" label="Input file" help="Input file is a tab-delimited file containing different information of proteins, such as an output of MaxQuant software" />
        <repeat name="keyword" title="Filter by keywords" >
            <param type="boolean" name="match" truevalue="True" label="Would you like to search for exact match?" help='By choosing "Yes" the tool will remove only the lines where selected column is matched exactly with the keyword(s), see below for more detail' />
            <conditional name="k" >
                <param argument="--kw" type="select" label="Filter by keyword" >
                    <option value="None" selected="True">---</option>
                    <option value="text">Enter keywords</option>
                    <option value="file">Choose a file containing keywords</option>
                </param>
                <when value="None" />
                <when value="text" >
                    <param name="txt" type="text" label="Enter keywords or a file containing keywords to be removed" />
                    <param name="ncol" type="text" value="c1" label="Please specify the column where you would like to apply this filter" help='For example, fill in "c1" if you want to filter the first column' />
                </when>
                <when value="file" >
                    <param name="file" type="data" format="txt,tab" label="Choose a file containing keywords" />
                    <param name="ncol" type="text" value="c1" label="Please specify the column where you would like to apply this filter" help='For example, fill in "c1" if you want to filter the first column' />
                </when>
            </conditional>
        </repeat>
        
        <repeat name="value" title="Filter by value" >
            <conditional name="v" >
                <param argument="--val" type="select" label="Filter by value" >
                    <option value="None">---</option>
                    <option value="Equal">=</option>
                    <option value="Higher">&gt;</option>
                    <option value="Equal or higher">&gt;=</option>
                    <option value="Lower">&lt;</option>
                    <option value="Equal or lower">&lt;=</option>
                </param>
                <when value="None" >
                </when>
                <when value="Equal" >
                    <param name="equal" type="float" value="" label="Value" />
                    <param name="ncol" type="text" value="c1" label="Please specify the column where you would like to apply this filter" help='For example, fill in "c1" if you want to filter the first column' />
                </when>
                <when value="Higher" >
                    <param type="float" name="higher" value="" label="Value" />
                    <param name="ncol" type="text" value="c1" label="Please specify the column where you would like to apply this filter" help='For example, fill in "c1" if you want to filter the first column' />
                </when>
                <when value="Equal or higher" >
                    <param type="float" name="equal_higher" value="" label="Value" />
                    <param name="ncol" type="text" value="c1" label="Please specify the column where you would like to apply this filter" help='For example, fill in "c1" if you want to filter the first column' />
                </when>
                <when value="Lower" >
                    <param type="float" name="lower" value="" label="Value" />
                    <param name="ncol" type="text" value="c1" label="Please specify the column where you would like to apply this filter" help='For example, fill in "c1" if you want to filter the first column' />
                </when>
                <when value="Equal or lower" >
                    <param type="float" name="equal_lower" value="" label="Value" />
                    <param name="ncol" type="text" value="c1" label="Please specify the column where you would like to apply this filter" help='For example, fill in "c1" if you want to filter the first column' />
                </when>
            </conditional>
        </repeat>
   
    </inputs>
    <outputs>
        <data name="output1" format="txt" label="${tool.name} on ${input1.name}" />
        <data name="trash_file" format="txt" label="Removed proteins from input file" />
    </outputs>
    <tests>       
    </tests>
    <help><![CDATA[
This tool allows you to filter a file that contains different information of proteins (for example, the output of MaxQuant software).

**For each row, if there are more than one protein IDs/protein names/gene names, only the first one will be considered in the output**

1. Filter the file by keywords. You can choose to use one or more options.    
    For each options, you can fill in the field or upload a file which contains the keywords.
    
    **Keywords can be case-insensitive**	
    
    **"Exact match" option:**	          
    
    - If you choose **Yes**, only the fields that contains exactly the same content will be removed.	
                
    - If you choose **No**, all the fields containing the keyword will be removed.
        
	For example:
	        
	    Exact match for "kinase": only lines which have exactly "kinase" is removed.
	             
	    Unexact match for "kinase": not only lines which have "kinase" but also lines which have "alpha-kinase" and so on are removed.
	             
    If you choose to fill in the field, the keywords should be separated by ":", for example:
        
        A8K2U0:Q5TA79:O43175
            
    In other case, you can choose a file in text format in which each lines is a keyword, for example:

    		A8K2U0
    		
    		Q5TA79
    		
    		O43175
    		
    **The line that contains these keywords will be eliminated from input file.**
	
2. Filter the file by values. You can choose to use one or more options.

	For each options, you can choose between "=", ">", ">=", "<" and "<=", then enter the value to filter and specify the column to apply that option.

**Available options**
	* **By keywords:**

		--protein_IDs
                	Protein IDs to filter
		--protein_names
                	Protein names to filter
		--gene_names
                	Gene names to filter

	* **By values:**

		--peptides
                	Peptides to filter
		--iBAQ
                	iBAQ/iBAQ ratio value to filter
		--number_of_proteins
                	Number of proteins to filter
		--intensity
                	Intensity value to filter
		--q_value
                	Q-value to filter
		--score         Score value to filter

**Output**

The tool will produce 2 output files.

* A text file containing the filtered input file.

* A text file containing the rows that were removed from input file. 

    ]]></help>
    <citations>
    </citations>
</tool>
