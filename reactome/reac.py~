import os
import json
import argparse

CURRENT_DIR = os.path.dirname(os.path.abspath(__file__))

def data_json(identifiers):
    if identifiers[1] == "list":
        json_string = os.popen("curl -H \"Content-Type: text/plain\" -d \"$(printf %s)\" -X POST --url http://www.reactome.org/AnalysisService/identifiers/projection/\?pageSize\=1\&page\=1" % identifiers[0]).read()
    elif identifiers[1] == "file":
        json_string = os.popen("curl -H \"Content-Type: text/plain\" --data-binary @%s -X POST --url http://www.reactome.org/AnalysisService/identifiers/projection/\?pageSize\=1\&page\=1" % identifiers[0]).read()
    print(json_string)
    return json_string

def write_output(filename, json_string):
    template = open(os.path.join(CURRENT_DIR, "template.html"))
    output = open(filename, "w")
    for line in template:
        if "{token}" in line:
            line = line.replace("{token}", json.loads(json_string)["summary"]["token"])
        output.write(line)
    template.close()
    output.close()

def options():
    parser = argparse.ArgumentParser()
    argument = parser.add_argument("--json", nargs=2, required=True)
    argument = parser.add_argument("--output", default="output.html")
    args = parser.parse_args()
    filename = args.output
    json_string = data_json(args.json)
    write_output(filename, json_string)

if __name__ == "__main__":
    options()
