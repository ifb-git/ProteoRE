<tool id="get_annotation" name="Retrieve information from public databases" version="0.1.0">
<requirements>
</requirements>
<stdio>
  <exit_code range="1:" />
</stdio>
<command><![CDATA[

  #if $inputtype.filetype == "copy_paste": 

    #if $database_type.database == "Nextprot":
  
    Rscript --vanilla $__tool_directory__/get_data_nextprot.R --inputtype copypaste --input '$inputtype.genelist' --nextprot $__tool_directory__/result_nextprot.txt --column c1 --argsP1 '$database_type.Nextprot_params.P1' --argsP2 '$database_type.Nextprot_params.P2'--argsP3 '$database_type.Nextprot_params.P3' --type '$database_type.idtype' --output '$output' --header None 
  
    #end if
    
    #if $database_type.database == "HPA":
  
    Rscript --vanilla $__tool_directory__/get_data_HPA_v2.R --inputtype copypaste --input '$inputtype.genelist' --header FALSE --proteinatlas $__tool_directory__/proteinatlas.csv --column c1 --select '$database_type.hpaparams' --output '$output'  
  
    #end if
  #end if

  #if $inputtype.filetype == "file_all": 

  #if $database_type.database == "Nextprot":
  Rscript --vanilla $__tool_directory__/get_data_nextprot.R --inputtype tabfile --input '$inputtype.genelist' --nextprot $__tool_directory__/result_nextprot.txt --column '$inputtype.column' --argsP1 '$database_type.Nextprot_params.P1' --argsP2 '$database_type.Nextprot_params.P2'--argsP3 '$database_type.Nextprot_params.P3' --type '$database_type.idtype' --output '$output' --header '$inputtype.header' 
  #end if

    #if $database_type.database == "HPA":
  
    Rscript --vanilla $__tool_directory__/get_data_HPA_v2.R --inputtype tabfile --input '$inputtype.genelist' --header '$inputtype.header' --proteinatlas $__tool_directory__/proteinatlas.csv --column '$inputtype.column' --select '$database_type.hpaparams' --output '$output'  
  
    #end if



  #end if
    

]]></command>

<inputs>
  <conditional name="inputtype">
    <param name="filetype" type="select" label="Select your type of input file"> 
      <option value="file_all">Input file containing your identifiers</option>
      <option value="copy_paste">Copy/paste your list of IDs</option> 
    </param>
    <when value="copy_paste">
      <param name="genelist" type="text" label="Enter a list of identifiers"/>
    </when>
    <when value="file_list">
      <param name="genelist" type="data" format="txt,tabular" label="Choose a single-column file" help="This file must have only 1 column containing IDs - For the type of IDs, please refer to the documentation below."/> 
      <param name="header" type="select" label="Does your file have a header?" multiple="false" optional="false"> 
 		      <option value="TRUE" selected="true">Yes</option>
          <option value="FALSE" selected="false">No</option>
      </param>
    </when>
    <when value="file_all">
      <param name="genelist" type="data" format="txt,tabular" label="Choose a multiple-columns file" help="This file must imperatively have 1 column filled with IDs consistent with the database that will be used. Please use the MappingIDs component if this is not the case."/>
      <param name="column" type="text" label="Please specify the column where you would like to apply the comparison (e.g : Enter c1)" value="c1"/> 
      <param name="header" type="select" label="Does your file have a header?" multiple="false" optional="false"> 
 		      <option value="TRUE" selected="true">Yes</option>
          <option value="FALSE" selected="false">No</option>
      </param>
    </when>
  </conditional>
  <conditional name="database_type">
    <param name="database" type="select" label="Choose a ressource to be retrieved">
      <option value="Nextprot">Nextprot</option>
      <option value="HPA">Retrieve information from the "Human Protein Atlas" (HPA)</option>
    </param>
    
    <when value="Nextprot">
      <section name="Nextprot_params" title="Choose the type of information (compulsory step)" expanded="True">
        <param name="P1" type="select" label="Physico-Chemical Features" multiple="true" help="Choose the information you want to add to your data from Nextprot" display="checkboxes" optional="true"> 
          <option value="MW" selected="false">Molecular Weight</option>
 		      <option value="SeqLength" selected="false">Sequence Length</option>
          <option value="IsoPoint" selected="false">Isoelectric point</option>
          <option value="TMDomains" selected="false">Number of transmembrane domains</option>
          <option value="ProteinExistence" selected="false">Protein Existence (PE level)</option>
        </param>

        <param name="P2" type="select" label="Localization" multiple="true" help="Choose the information you want to add to your data from Nextprot" display="checkboxes" optional="true"> 
 		      <option value="Chr" selected="false">Chromosome</option>
 		      <option value="SubcellLocations" selected="false">Subcellular Location</option>
        </param>

        <param name="P3" type="select" label="Diseases information">
          <option value="Diseases">Yes</option>
          <option value="None">No</option>
        </param>
      </section>

      <param name="idtype" type="select" label="Type of your input ids" multiple="false" optional="false"> 
 		      <option value="nextprot" selected="false">Nextprot IDs</option>
          <option value="uniprot" selected="true">Uniprot IDs</option>
      </param>

      </when>
  
    <when value="HPA">
        <param name="hpaparams" type="select" label="Human Protein Atlas Informations" multiple="true" help="Choose the information you want to add to your data from HPA" display="checkboxes" optional="false"> 
          <option value="RNA.tissue.category" selected="false">RNA tissue category</option>
 		      <option value="Reliability..IH." selected="false">IH detection level</option>
          <option value="Reliability..IF." selected="false">IF detection level</option>
        </param>



      </when>
  
    </conditional>

</inputs>


<outputs>
  <data name="output" format="tsv" label="Add information from ${database_type.database}"/>


</outputs>
<help><![CDATA[

This tool filters an input **tabular** file according to different databases.

**Input**

Input can be a file containing multiple fields but with **at least one column of Ensembl gene IDs** or a list of Ensembl gene ids. If your input file contains other kind of IDs, please refer to the MappingIDs component to create a column of Ensembl gene IDs.  

**Databases**

The input file will be filtered using information from different sources : 

- HPA normal tissue : will filter the input according to the data contained in the Human Protein Atlas webservice. Pertinent information, such as tissular location, will be added for each gene to your input file.  

- HPA cancer tissue :  will filter the input according to the data contained in the Human Protein Atlas webservice for cancer. Pertinent information, such as tumor type, will be added for each gene to your input file.  

**Parameters**

For HPA normal tissue :

- tissue category : categories based on RNA-Seq data to estimate the transcript abundance of each protein-coding gene in tissues. For more information, please refer to http://www.proteinatlas.org/about/assays+annotation#rna .

- level of detection IF : level of detection of the protein associated to the coding gene tissues based on immunofluorescency. For more information, please refer to http://www.proteinatlas.org/about/assays+annotation#if .

- level of detection IH :  level of detection of the protein associated to the coding gene tissues based on immunohistochemistry. For more information, please refer to http://www.proteinatlas.org/about/assays+annotation#if .

For HPA cancer tissue : 

- tumors : which tumors are associated with your protein-coding genes according to the Human Protein Atlas.


**Outputs**

The output will be a tabular file. The initial columns will be kept, but lines can be deleted due to the filtering process. Additional columns will be added according to which data you chose to filter your input with.  


**Data sources**

The data for HPA normal tissue was retrieved from the Human Protein Atlas downloadable data repository (http://www.proteinatlas.org/download/proteinatlas.tab.gz).

The data for HPA cancer was retrieved from the Human Protein Atlas downloadable data repository (http://www.proteinatlas.org/download/cancer.csv.zip).
]]></help>


<tests>
  <test>
    <conditional name="inputtype">
      <param name="filetype " value="tabfile"/>
      <param name="genelist" value="mitochondrion_enzymes_Nextprot.txt"/>
      <param name="column" value="c1"/>
      <param name="header" value="TRUE"/>
    </conditional>
    <conditional name="database_type">
      <param name="database" value="Nextprot"/>

      <section name="Nextprot_params">
        <param name="P1" value="MW,SeqLength,IsoPoint,TMDomains,ProteinExistence"/> 
        <param name="P2" value="Chr,SubcellLocations"/> 
        <param name="P3" value="Diseases"/> 
      </section>
      <param name="idtype" value="nextprot"/> 
    </conditional>
    <output name="output" file="output_get_data.tsv"/>
  </test>
</tests>

</tool>
